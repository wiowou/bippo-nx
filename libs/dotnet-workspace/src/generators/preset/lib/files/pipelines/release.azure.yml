trigger:
  branches:
    include:
      - master

resources:
  repositories:
    - repository: PipelineTemplates
      type: github
      name: wiowou/ADOTemplates
      ref: master
      endpoint: github.com_wiowou # service connection name

variables:
  - name: node_version
    value: '18.12.1'
  - name: terraform_version
    value: '1.4.5'
  - name: dotnet_version
    value: '8.0.x'
  - name: run_all
    value: false

stages:
  - template: stages/build.yml@PipelineTemplates
    parameters:
      run_all: ${{ variables.run_all }}

  - template: stages/migrate.yml@PipelineTemplates
    parameters:
      run_all: ${{ variables.run_all }}
      application_environment: dev
      project_name: '<%= name %>'
      region: us-east-1

  - template: stages/deploy.yml@PipelineTemplates
    parameters:
      application_environment: dev
      run_all: ${{ variables.run_all }}
